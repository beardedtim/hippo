const fs = require('@/fs')
/**
   * The Cache is a map of URL -> File Content
   * 
   * @type {Map<string, string>}
   */
let cache = new Map()

/**
 * This module exposes a worker that sits on top of
 * the File System and has a LRU cache of files
 */
module.exports.create = () => ({
  has: async (path) => cache.has(path),
  set: async (path, str) => cache.set(path, str),
  get: async (path) => {
    const file = await fs.readfile(path, 'utf8')

    await cache.set(path, file)

    return file
  }
})

module.exports.invalidate = (key) => cache.delete(key)
module.exports.reset = () => cache = new Map()