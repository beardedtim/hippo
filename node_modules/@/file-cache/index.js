const fs = require('fs')
const { promisify } = require('util')
/**
 * This module exposes a worker that sits on top of
 * the File System and has a LRU cache of files
 */

const readfile = promisify(fs.readFile)

module.exports.create = () => {
  /**
   * The Cache is a map of URL -> File Content
   * 
   * @type {Map<string, string>}
   */
  const cache = new Map()

  return {
    has: async (path) => cache.has(path),
    set: async (path, str) => cache.set(path, str),
    get: async (path) => {
      const file = await readfile(path, 'utf8')

      await cache.set(path, file)

      return file
    }
  }
}